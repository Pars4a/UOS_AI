<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Haawall - University of Sulaimani Assistant</title>
  <link rel="shortcut icon" href="static/images/uos-icon.ico" type="image/x-icon">
  <link rel="stylesheet" href="static/style.css">
</head>

<body>
  <!-- Authentication Overlay -->
  <div class="auth-overlay" id="authOverlay">
    <div class="auth-overlay-content">
      <div class="auth-welcome">
        <div class="auth-logo">
          <img src="static/images/uoswelcomelogo.png" alt="Haawall Logo">
        </div>
        <h1 class="auth-welcome-title">Welcome to Haawall</h1>
        <p class="auth-welcome-subtitle">Your University of Sulaimani AI Assistant</p>
      </div>
      
      <div class="auth-options">
        <button class="auth-option-btn primary" onclick="showLogin()">
          <div class="auth-option-icon">👤</div>
          <div class="auth-option-content">
            <div class="auth-option-title">Sign In</div>
            <div class="auth-option-desc">Access your account and chat history</div>
          </div>
        </button>
        
        <button class="auth-option-btn" onclick="showRegister()">
          <div class="auth-option-icon">✨</div>
          <div class="auth-option-content">
            <div class="auth-option-title">Create Account</div>
            <div class="auth-option-desc">Join Haawall and save your conversations</div>
          </div>
        </button>
        
        <button class="auth-option-btn guest" onclick="continueAsGuest()">
          <div class="auth-option-icon">🚀</div>
          <div class="auth-option-content">
            <div class="auth-option-title">Continue as Guest</div>
            <div class="auth-option-desc">Start chatting without an account</div>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Login Form Overlay -->
  <div class="auth-form-overlay hidden" id="loginOverlay">
    <div class="auth-form-content">
      <button class="auth-close-btn" onclick="hideAuthForms()">×</button>
      <h2 class="auth-form-title">Sign In</h2>
      <form id="loginForm" class="auth-form">
        <div class="form-group">
          <input type="email" id="loginEmail" placeholder="Email" required>
        </div>
          <label class="form-label">Email</label>
        <div class="form-group">
          <input type="password" id="loginPassword" placeholder="Password" required>
      
          <label class="form-label">Password</label>
      <div id="loginMessage" class="auth-message"></div>
      
        </div>
          <span id="loginBtnText">Sign In</span>
        <button type="submit" class="auth-submit-btn">Sign In</button>
        <div class="auth-form-links">
          <a href="#" onclick="showRegister()">Don't have an account? Sign up</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Register Form Overlay -->
  <div class="auth-form-overlay hidden" id="registerOverlay">
    <div class="auth-form-content">
      <button class="auth-close-btn" onclick="hideAuthForms()">×</button>
      <h2 class="auth-form-title">Create Account</h2>
      <form id="registerForm" class="auth-form">
        <div class="form-group">
          <input type="text" id="registerName" placeholder="Full Name" required>
        </div>
        <div class="form-group">
          <input type="email" id="registerEmail" placeholder="Email" required>
      
      <div id="registerMessage" class="auth-message"></div>
          <label class="form-label">Email</label>
      
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <label class="form-label">Full Name</label>
          <div class="password-hint">Password must be at least 6 characters long</div>
          <input type="password" id="registerPassword" placeholder="Password (min 6 characters)" required>
        </div>
          <span id="registerBtnText">Create Account</span>
        <button type="submit" class="auth-submit-btn">Create Account</button>
        <div class="auth-form-links">
          <a href="#" onclick="showLogin()">Already have an account? Sign in</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div class="app-container" id="appContainer">
    <!-- Header -->
    <div class="header">
      <div class="mobile-menu-icon" onclick="toggleMenu()">☰</div>
      
      <nav class="main-nav left desktop-only">
        <a href="/" class="nav-link active">Home</a>
        <a href="about" class="nav-link">About</a>
        <div class="admin-dashboard-container" id="adminDashboardContainer" style="display: none;">
          <a href="/dashboard" class="nav-link dashboard-btn">Dashboard</a>
        </div>
      </nav>
      
      <div class="logo"> 
        <div class="logo-icon">
          <img src="static/images/uoswelcomelogo.png" alt="Haawall Logo">
        </div>
        Haawall
      </div>
      
      <nav class="main-nav right desktop-only">
        <button onclick="toggleLanguage()" id="langSwitchBtn" class="lang-toggle">کوردی</button>
        <div class="user-menu" id="userMenu">
          <!-- Will be populated by JavaScript -->
        </div>
        <a href="contact" class="nav-link contact-btn">Contact Us</a>
      </nav>

      <div class="mobile-controls">
        <button onclick="toggleLanguage()" id="langSwitchBtnMobile" class="lang-toggle">کوردی</button>
        <div class="user-menu-mobile" id="userMenuMobile">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      
      <div class="mobile-menu hidden" id="mobileMenu">
        <a href="/" class="nav-link active">Home</a>
        <a href="about" class="nav-link">About</a>
        <div class="admin-dashboard-mobile" id="adminDashboardMobile" style="display: none;">
          <a href="/dashboard" class="nav-link dashboard-btn">Dashboard</a>
        </div>
        <a href="contact" class="nav-link contact-btn">Contact Us</a>
        <div class="mobile-user-menu" id="mobileUserMenu">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <div class="quick-actions-container">
        <button class="quick-action-btn" onclick="sendQuickMessage('What programs does the University of Sulaimani offer?')">
          <div class="quick-action-title" id="quickAction1Title">Academic Programs</div>
          <div class="quick-action-text" id="quickAction1Text">Explore available degrees and courses</div>
        </button>
        <button class="quick-action-btn" onclick="sendQuickMessage('How do I apply for admission to the University of Sulaimani?')">
          <div class="quick-action-title" id="quickAction2Title">Admissions</div>
          <div class="quick-action-text" id="quickAction2Text">Learn about the application process</div>
        </button>
        <button class="quick-action-btn" onclick="sendQuickMessage('What facilities are available on campus?')">
          <div class="quick-action-title" id="quickAction3Title">Campus Life</div>
          <div class="quick-action-text" id="quickAction3Text">Discover campus facilities and services</div>
        </button>
        <button class="quick-action-btn" onclick="sendQuickMessage('Tell me about scholarships and financial aid.')">
          <div class="quick-action-title" id="quickAction4Title">Financial Aid</div>
          <div class="quick-action-text" id="quickAction4Text">Information about scholarships and support</div>
        </button>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container">
      <!-- Welcome Screen -->
      <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-logo">
          <img src="static/images/uoswelcomelogo.png" alt="Haawall Logo">
        </div>
        <h1 class="welcome-title" id="welcomeTitle">Welcome to Haawall</h1>
        <p class="welcome-subtitle" id="welcomeSubtitle">
          Your intelligent University of Sulaimani assistant. Ask me anything about programs, admissions, campus life, and more!
        </p>
      </div>

      <!-- Messages -->
      <div class="messages" id="messages"></div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <textarea 
          class="message-input" 
          id="messageInput" 
          placeholder="Ask me anything about University of Sulaimani..."
          rows="1"
        ></textarea>
        <button class="send-button" id="sendButton" onclick="sendMessage()">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- FAQ Button -->
    <button class="faq-button" onclick="toggleFAQ()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
      </svg>
    </button>

    <!-- FAQ Dropdown -->
    <div class="faq-dropdown" id="faqDropdown">
      <div class="faq-header" id="faqHeader">Frequently Asked Questions</div>
      <div class="faq-list">
        <div class="faq-item" onclick="sendQuickMessage('What are the admission requirements?')" id="faq1">What are the admission requirements?</div>
        <div class="faq-item" onclick="sendQuickMessage('How much are the tuition fees?')" id="faq2">How much are the tuition fees?</div>
        <div class="faq-item" onclick="sendQuickMessage('What programs are available in English?')" id="faq3">What programs are available in English?</div>
        <div class="faq-item" onclick="sendQuickMessage('How do I contact the admissions office?')" id="faq4">How do I contact the admissions office?</div>
        <div class="faq-item" onclick="sendQuickMessage('What is campus life like?')" id="faq5">What is campus life like?</div>
        <div class="faq-item" onclick="sendQuickMessage('Are there dormitories available?')" id="faq6">Are there dormitories available?</div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <script>
    let currentLang = 'en';
    let currentUser = null;
    let isAuthenticated = false;

    // Translations
    const translations = {
      en: {
        switchText: "کوردی",
        welcomeTitle: "Welcome to Haawall",
        welcomeSubtitle: "Your intelligent University of Sulaimani assistant. Ask me anything about programs, admissions, campus life, and more!",
        quickAction1Title: "Academic Programs",
        quickAction1Text: "Explore available degrees and courses",
        quickAction2Title: "Admissions", 
        quickAction2Text: "Learn about the application process",
        quickAction3Title: "Campus Life",
        quickAction3Text: "Discover campus facilities and services",
        quickAction4Title: "Financial Aid",
        quickAction4Text: "Information about scholarships and support",
        faqHeader: "Frequently Asked Questions",
        faq1: "What are the admission requirements?",
        faq2: "How much are the tuition fees?",
        faq3: "What programs are available in English?",
        faq4: "How do I contact the admissions office?",
        faq5: "What is campus life like?",
        faq6: "Are there dormitories available?"
      },
      ku: {
        switchText: "English",
        welcomeTitle: "بەخێربێیت بۆ هاواڵ",
        welcomeSubtitle: "یاریدەدەری زیرەکی زانکۆی سلێمانی. هەر پرسیارێکت هەبێت دەربارەی بەرنامەکان، وەرگرتن، ژیانی کەمپەس و زیاتر!",
        quickAction1Title: "بەرنامە ئەکادیمییەکان",
        quickAction1Text: "بەرنامە و کۆرسە بەردەستەکان بناسە",
        quickAction2Title: "وەرگرتن",
        quickAction2Text: "دەربارەی پرۆسەی داخوازینامە زانیاری وەربگرە",
        quickAction3Title: "ژیانی کەمپەس",
        quickAction3Text: "ئامرازەکان و خزمەتگوزارییەکانی کەمپەس بدۆزەرەوە",
        quickAction4Title: "یارمەتی دارایی",
        quickAction4Text: "زانیاری دەربارەی بورس و پشتگیری",
        faqHeader: "پرسیارە دووبارەبووەکان",
        faq1: "مەرجەکانی وەرگرتن چین؟",
        faq2: "کرێی خوێندن چەندە؟",
        faq3: "چ بەرنامەیەک بە ئینگلیزی هەیە؟",
        faq4: "چۆن پەیوەندی بە ئۆفیسی وەرگرتنەوە بکەم؟",
        faq5: "ژیانی کەمپەس چۆنە؟",
        faq6: "نیشتەجێبوون بەردەستە؟"
      }
    };

    // Authentication functions
    async function checkAuthStatus() {
      const token = localStorage.getItem('access_token');
      if (!token) {
        showAuthOverlay();
        return;
      }

      try {
        const response = await fetch('/auth/me', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (response.ok) {
          currentUser = await response.json();
          isAuthenticated = true;
          hideAuthOverlay();
          updateUserMenu();
        } else {
          localStorage.removeItem('access_token');
          showAuthOverlay();
        }
      } catch (error) {
        console.error('Auth check failed:', error);
        showAuthOverlay();
      }
    }

    function showAuthOverlay() {
      document.getElementById('authOverlay').classList.remove('hidden');
      document.getElementById('appContainer').style.filter = 'blur(5px)';
    }

    function hideAuthOverlay() {
      document.getElementById('authOverlay').classList.add('hidden');
      document.getElementById('appContainer').style.filter = 'none';
    }

    function showLogin() {
      document.getElementById('authOverlay').classList.add('hidden');
      document.getElementById('loginOverlay').classList.remove('hidden');
    }

    function showRegister() {
      document.getElementById('authOverlay').classList.add('hidden');
      document.getElementById('registerOverlay').classList.remove('hidden');
    }

    function hideAuthForms() {
      document.getElementById('loginOverlay').classList.add('hidden');
      document.getElementById('registerOverlay').classList.add('hidden');
      showAuthOverlay();
    }

    async function continueAsGuest() {
      try {
        const response = await fetch('/auth/guest', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({})
        });

        if (response.ok) {
          const result = await response.json();
          localStorage.setItem('access_token', result.access_token);
          currentUser = { user_type: 'guest' };
          isAuthenticated = true;
          hideAuthOverlay();
          updateUserMenu();
        }
      } catch (error) {
        console.error('Guest login failed:', error);
      }
    }

    function updateUserMenu() {
      const userMenu = document.getElementById('userMenu');
      const userMenuMobile = document.getElementById('userMenuMobile');
      const mobileUserMenu = document.getElementById('mobileUserMenu');
      const adminDashboardContainer = document.getElementById('adminDashboardContainer');
      const adminDashboardMobile = document.getElementById('adminDashboardMobile');

      let menuHTML = '';
      
      // Show/hide admin dashboard button
      if (currentUser && currentUser.user_type === 'admin') {
        adminDashboardContainer.style.display = 'block';
        adminDashboardMobile.style.display = 'block';
      } else {
        adminDashboardContainer.style.display = 'none';
        adminDashboardMobile.style.display = 'none';
      }
      
      if (currentUser) {
        if (currentUser.user_type === 'admin') {
          menuHTML = `
            <div class="user-dropdown">
              <button class="user-btn" onclick="toggleUserDropdown()">
                ${currentUser.full_name || 'Admin'} ▼
              </button>
              <div class="user-dropdown-menu" id="userDropdownMenu">
                <a href="#" onclick="showProfile()">Profile</a>
                <a href="#" onclick="showChatHistory()">Chat History</a>
                <a href="#" onclick="logout()">Logout</a>
              </div>
            </div>
          `;
        } else if (currentUser.user_type === 'user') {
          menuHTML = `
            <div class="user-dropdown">
              <button class="user-btn" onclick="toggleUserDropdown()">
                ${currentUser.full_name || 'User'} ▼
              </button>
              <div class="user-dropdown-menu" id="userDropdownMenu">
                <a href="#" onclick="showProfile()">Profile</a>
                <a href="#" onclick="showChatHistory()">Chat History</a>
                <a href="#" onclick="logout()">Logout</a>
              </div>
            </div>
          `;
        } else {
          menuHTML = `
            <button class="nav-link" onclick="logout()">Exit Guest Mode</button>
          `;
        }
      }

      userMenu.innerHTML = menuHTML;
      userMenuMobile.innerHTML = menuHTML;
      mobileUserMenu.innerHTML = menuHTML;
    }

    // Login form handler
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const loginBtn = document.querySelector('#loginForm .auth-submit-btn');
      const loginBtnText = document.getElementById('loginBtnText');
      const loginMessage = document.getElementById('loginMessage');
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      // Show loading state
      loginBtn.disabled = true;
      loginBtnText.innerHTML = '<div class="loading"></div>Signing in...';
      loginMessage.style.display = 'none';
      
      try {
        const response = await fetch('/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });
        
        if (response.ok) {
          const result = await response.json();
          localStorage.setItem('access_token', result.access_token);
          localStorage.setItem('user_type', result.user_type);
          localStorage.setItem('user_id', result.user_id);
          
          currentUser = {
            user_type: result.user_type,
            user_id: result.user_id,
            email: email,
            full_name: result.full_name || email.split('@')[0]
          };
          isAuthenticated = true;
          
          // Show success message
          loginMessage.textContent = 'Login successful! Welcome back.';
          loginMessage.className = 'auth-message success';
          loginMessage.style.display = 'block';
          
          setTimeout(() => {
          hideAuthForms();
          hideAuthOverlay();
          updateUserMenu();
          }, 1000);
        } else {
          const error = await response.json();
          loginMessage.textContent = error.detail || 'Login failed. Please check your credentials.';
          loginMessage.className = 'auth-message error';
          loginMessage.style.display = 'block';
        }
      } catch (error) {
        console.error('Login error:', error);
        loginMessage.textContent = 'Connection error. Please try again.';
        loginMessage.className = 'auth-message error';
        loginMessage.style.display = 'block';
      } finally {
        loginBtn.disabled = false;
        loginBtnText.textContent = 'Sign In';
      }
    });

    // Register form handler
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const registerBtn = document.querySelector('#registerForm .auth-submit-btn');
      const registerBtnText = document.getElementById('registerBtnText');
      const registerMessage = document.getElementById('registerMessage');
      
      const full_name = document.getElementById('registerName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      
      if (password.length < 6) {
        registerMessage.textContent = 'Password must be at least 6 characters long';
        registerMessage.className = 'auth-message error';
        registerMessage.style.display = 'block';
        return;
      }
      
      // Show loading state
      registerBtn.disabled = true;
      registerBtnText.innerHTML = '<div class="loading"></div>Creating account...';
      registerMessage.style.display = 'none';
      
      try {
        const response = await fetch('/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password, full_name })
        });
        
        if (response.ok) {
          const result = await response.json();
          localStorage.setItem('access_token', result.access_token);
          localStorage.setItem('user_type', result.user_type);
          localStorage.setItem('user_id', result.user_id);
          
          currentUser = {
            user_type: result.user_type,
            user_id: result.user_id,
            email: email,
            full_name: full_name
          };
          isAuthenticated = true;
          
          // Show success message
          registerMessage.textContent = 'Account created successfully! Welcome to Haawall.';
          registerMessage.className = 'auth-message success';
          registerMessage.style.display = 'block';
          
          setTimeout(() => {
          hideAuthForms();
          hideAuthOverlay();
          updateUserMenu();
          }, 1000);
        } else {
          const error = await response.json();
          registerMessage.textContent = error.detail || 'Registration failed. Please try again.';
          registerMessage.className = 'auth-message error';
          registerMessage.style.display = 'block';
        }
      } catch (error) {
        console.error('Registration error:', error);
        registerMessage.textContent = 'Connection error. Please try again.';
        registerMessage.className = 'auth-message error';
        registerMessage.style.display = 'block';
      } finally {
        registerBtn.disabled = false;
        registerBtnText.textContent = 'Create Account';
      }
    });

    function logout() {
      localStorage.removeItem('access_token');
      currentUser = null;
      isAuthenticated = false;
      showAuthOverlay();
      updateUserMenu();
    }

    function toggleUserDropdown() {
      const dropdown = document.getElementById('userDropdownMenu');
      dropdown.classList.toggle('show');
    }

    function showProfile() {
      if (currentUser.user_type === 'guest') {
        alert('Please create an account to access profile features.');
        return;
      }
       
      window.location.href = '/profile';
    }

    function showChatHistory() {
      alert('Chat history feature coming soon!');
    }

    // Language toggle
    function toggleLanguage() {
      currentLang = currentLang === 'en' ? 'ku' : 'en';
      const t = translations[currentLang];

      document.getElementById('langSwitchBtn').innerText = t.switchText;
      document.getElementById('langSwitchBtnMobile').innerText = t.switchText;
      
      Object.keys(t).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.innerHTML = t[id];
      });
    }

    // Mobile menu toggle
    function toggleMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('hidden');
    }

    // FAQ toggle
    function toggleFAQ() {
      const dropdown = document.getElementById('faqDropdown');
      dropdown.classList.toggle('show');
    }

    // Chat functionality
    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      input.value = '';
      hideWelcomeScreen();
      addMessage(message, 'user');
      showTypingIndicator();
      
      try {
        const token = localStorage.getItem('access_token');
        const response = await fetch('/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': token ? `Bearer ${token}` : ''
          },
          body: JSON.stringify({ message })
        });
        
        hideTypingIndicator();
        
        if (response.ok) {
          const result = await response.json();
          addMessage(result.response, 'assistant');
        } else {
          const error = await response.json();
          addMessage(error.detail || 'Sorry, I encountered an error. Please try again.', 'assistant', true);
        }
      } catch (error) {
        hideTypingIndicator();
        addMessage('Connection error. Please check your internet and try again.', 'assistant', true);
      }
    }

    function sendQuickMessage(message) {
      document.getElementById('messageInput').value = message;
      sendMessage();
    }

    function addMessage(content, sender, isError = false) {
      const messagesContainer = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.textContent = sender === 'user' ? 'U' : 'H';
      
      const messageContent = document.createElement('div');
      messageContent.className = isError ? 'message-content error-message' : 'message-content';
      messageContent.textContent = content;
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(messageContent);
      messagesContainer.appendChild(messageDiv);
      
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function hideWelcomeScreen() {
      document.getElementById('welcomeScreen').classList.add('hidden');
    }

    function showTypingIndicator() {
      const messagesContainer = document.getElementById('messages');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing-indicator';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = `
        <div class="typing-avatar"></div>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      `;
      messagesContainer.appendChild(typingDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function hideTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) {
        indicator.remove();
      }
    }

    // Input handling
    document.getElementById('messageInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Auto-resize textarea
    document.getElementById('messageInput').addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 200) + 'px';
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.matches('.user-btn')) {
        const dropdown = document.getElementById('userDropdownMenu');
        if (dropdown) dropdown.classList.remove('show');
      }
      
      if (!e.target.closest('.faq-button') && !e.target.closest('.faq-dropdown')) {
        document.getElementById('faqDropdown').classList.remove('show');
      }
    });

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      checkAuthStatus();
    });
  </script>
</body>
</html>